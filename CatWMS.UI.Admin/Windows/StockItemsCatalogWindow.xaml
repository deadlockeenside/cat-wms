<Window x:Class="CatWMS.UI.Admin.Windows.StockItemsCatalogWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:res="clr-namespace:CatWMS.UI.Admin.Common"
        xmlns:conv="clr-namespace:CatWMS.UI.Admin.Converters"
        mc:Ignorable="d"
        Width="900"
        Height="600"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        Background="White">

    <!-- 🔹 Конвертеры -->
    <Window.Resources>
        <conv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <conv:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" />
    </Window.Resources>

    <Grid>

        <!-- 🔸 Таблица -->
        <DataGrid ItemsSource="{Binding Items}"
                  Visibility="{Binding HasItems, Converter={StaticResource BoolToVisibilityConverter}}"
                  AutoGenerateColumns="False"
                  AlternatingRowBackground="#FFF5F5F5"
                  RowBackground="White"
                  GridLinesVisibility="None"
                  HeadersVisibility="All"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  CanUserReorderColumns="False"
                  CanUserResizeRows="False"
                  BorderThickness="0"
                  FontSize="14"
                  FontFamily="Segoe UI"
                  RowHeight="40"
                  Margin="0,10,0,0"
                  SelectionMode="Single"
                  SelectionUnit="FullRow">

            <DataGrid.Resources>
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Background" Value="#222"/>
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                    <Setter Property="Height" Value="42"/>
                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                    <Setter Property="BorderBrush" Value="#111"/>
                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                </Style>

                <Style TargetType="DataGridRow">
                    <Setter Property="Cursor" Value="Hand"/>
                    <Setter Property="Background" Value="White"/>
                    <Setter Property="SnapsToDevicePixels" Value="True"/>
                    <Setter Property="BorderBrush" Value="Transparent"/>
                    <Setter Property="BorderThickness" Value="0"/>
                    <Setter Property="Padding" Value="4"/>
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#EAEAEA"/>
                        </Trigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="#C0E6FF"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.Resources>

            <DataGrid.Columns>
                <DataGridTextColumn Header="{x:Static res:Labels.StockItemsCatalogColumnName}"
                                    Binding="{Binding Name}"
                                    Width="*" />
            </DataGrid.Columns>
        </DataGrid>

        <!-- 🔸 Пустое состояние -->
        <StackPanel VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    Opacity="0.7"
                    TextBlock.FontFamily="Segoe UI"
                    TextBlock.FontSize="18"
                    TextBlock.Foreground="#555"
                    TextBlock.TextAlignment="Center">

            <StackPanel.Visibility>
                <MultiBinding Converter="{StaticResource BoolToVisibilityConverter}" ConverterParameter="inverse">
                    <Binding Path="HasItems"/>
                    <Binding Path="IsLoading"/>
                </MultiBinding>
            </StackPanel.Visibility>

            <Image Source="/CatWMS.UI.Admin;component/Assets/empty_yarn.jpg"
                   Width="300"
                   Height="140"
                   Margin="0,0,0,20" />

            <TextBlock Text="{x:Static res:Labels.StockItemsCatalogEmpty}"
                       FontWeight="SemiBold" />
        </StackPanel>

        <!-- 🐱 Анимированная загрузка -->
        <Grid x:Name="LoadingOverlay"
              Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
              Background="#80FFFFFF"
              VerticalAlignment="Stretch"
              HorizontalAlignment="Stretch"
              Panel.ZIndex="10">

            <Grid.Style>
                <Style TargetType="Grid">
                    <Setter Property="Opacity" Value="0"/>
                    <Style.Triggers>
                        <Trigger Property="Visibility" Value="Visible">
                            <Trigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                         To="1"
                                                         Duration="0:0:0.3"
                                                         FillBehavior="HoldEnd" />
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.EnterActions>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </Grid.Style>

            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <Canvas Width="220" Height="160">

                    <!-- 🧶 Нитка -->
                    <Path x:Name="StringPath"
                          Stroke="#AA2222"
                          StrokeThickness="1.5"
                          StrokeDashArray="2,2"
                          StrokeDashOffset="0"
                          Data="M140,100 C150,95 160,105 170,100"/>

                    <!-- 🧶 Клубок -->
                    <Ellipse x:Name="Ball"
                             Width="30" Height="30"
                             Fill="#CC4444"
                             Canvas.Left="140" Canvas.Top="90">
                        <Ellipse.RenderTransform>
                            <RotateTransform CenterX="15" CenterY="15"/>
                        </Ellipse.RenderTransform>
                    </Ellipse>

                    <!-- 🐈 Тело -->
                    <Ellipse Width="100" Height="70" Fill="#222" Canvas.Left="30" Canvas.Top="60"/>

                    <!-- 🐾 Лапка -->
                    <Ellipse x:Name="Paw" Width="20" Height="12" Fill="#222" Canvas.Left="105" Canvas.Top="95"/>

                    <!-- 🐈 Хвост -->
                    <Path x:Name="CatTail"
                          Stroke="#222"
                          StrokeThickness="10"
                          StrokeEndLineCap="Round"
                          Data="M 120,90 Q 145,70 165,80">
                        <Path.RenderTransform>
                            <RotateTransform CenterX="120" CenterY="90"/>
                        </Path.RenderTransform>
                    </Path>

                    <!-- 🐈 Голова -->
                    <Ellipse x:Name="CatHead" Width="60" Height="60" Fill="#222" Canvas.Left="45" Canvas.Top="20">
                        <Ellipse.RenderTransform>
                            <RotateTransform CenterX="75" CenterY="50"/>
                        </Ellipse.RenderTransform>
                    </Ellipse>

                    <!-- Уши -->
                    <Polygon Points="50,25 40,10 60,18" Fill="#222"/>
                    <Polygon Points="105,25 115,10 95,18" Fill="#222"/>

                    <!-- Глаза -->
                    <Ellipse x:Name="LeftEye" Width="8" Height="8" Fill="#FFD93B" Canvas.Left="65" Canvas.Top="40"/>
                    <Ellipse x:Name="RightEye" Width="8" Height="8" Fill="#FFD93B" Canvas.Left="87" Canvas.Top="40"/>

                    <!-- Рот -->
                    <Path Stroke="#FFD93B" StrokeThickness="1.5" Data="M75,55 Q80,60 85,55"/>

                    <!-- 😸 Анимации -->
                    <Canvas.Triggers>

                        <!-- Моргает -->
                        <EventTrigger RoutedEvent="Loaded">
                            <BeginStoryboard>
                                <Storyboard RepeatBehavior="Forever">
                                    <DoubleAnimation Storyboard.TargetName="LeftEye"
                                                     Storyboard.TargetProperty="Height"
                                                     From="8" To="1"
                                                     Duration="0:0:0.1"
                                                     AutoReverse="True"
                                                     BeginTime="0:0:3" />
                                    <DoubleAnimation Storyboard.TargetName="RightEye"
                                                     Storyboard.TargetProperty="Height"
                                                     From="8" To="1"
                                                     Duration="0:0:0.1"
                                                     AutoReverse="True"
                                                     BeginTime="0:0:3" />
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>

                        <!-- Хвост виляет -->
                        <EventTrigger RoutedEvent="Loaded">
                            <BeginStoryboard>
                                <Storyboard RepeatBehavior="Forever" AutoReverse="True">
                                    <DoubleAnimation Storyboard.TargetName="CatTail"
                                                     Storyboard.TargetProperty="(Path.RenderTransform).(RotateTransform.Angle)"
                                                     From="-10" To="15"
                                                     Duration="0:0:1.2" />
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>

                        <!-- Клубок катится -->
                        <EventTrigger RoutedEvent="Loaded">
                            <BeginStoryboard>
                                <Storyboard RepeatBehavior="Forever" AutoReverse="True">

                                    <DoubleAnimation Storyboard.TargetName="Ball"
                                                     Storyboard.TargetProperty="(Canvas.Left)"
                                                     From="140" To="100"
                                                     Duration="0:0:1.8"/>

                                    <!-- Вращение клубка -->
                                    <DoubleAnimation Storyboard.TargetName="Ball"
                                                     Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                                                     From="0" To="360"
                                                     Duration="0:0:1.2"
                                                     RepeatBehavior="Forever"/>

                                    <!-- Имитация движения нитки -->
                                    <DoubleAnimation Storyboard.TargetName="StringPath"
                                                     Storyboard.TargetProperty="StrokeDashOffset"
                                                     From="0" To="10"
                                                     Duration="0:0:1.8"
                                                     AutoReverse="True"
                                                     RepeatBehavior="Forever"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>

                        <!-- Лапка тянется -->
                        <EventTrigger RoutedEvent="Loaded">
                            <BeginStoryboard>
                                <Storyboard RepeatBehavior="Forever" AutoReverse="True">
                                    <DoubleAnimation Storyboard.TargetName="Paw"
                                                     Storyboard.TargetProperty="(Canvas.Top)"
                                                     From="95" To="85"
                                                     Duration="0:0:0.8" />
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>

                        <!-- Голова наклоняется -->
                        <EventTrigger RoutedEvent="Loaded">
                            <BeginStoryboard>
                                <Storyboard RepeatBehavior="Forever" AutoReverse="True">
                                    <DoubleAnimation Storyboard.TargetName="CatHead"
                                                     Storyboard.TargetProperty="(Ellipse.RenderTransform).(RotateTransform.Angle)"
                                                     From="-5" To="7"
                                                     Duration="0:0:1.8" />
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>

                    </Canvas.Triggers>
                </Canvas>

                <!-- Текст “Загрузка...” -->
                <TextBlock Text="Загрузка..."
                           FontSize="16"
                           FontWeight="SemiBold"
                           Foreground="#444"
                           HorizontalAlignment="Center"
                           Margin="0,15,0,0">
                    <TextBlock.Triggers>
                        <EventTrigger RoutedEvent="Loaded">
                            <BeginStoryboard>
                                <Storyboard RepeatBehavior="Forever" AutoReverse="True">
                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                     From="1" To="0.3"
                                                     Duration="0:0:1"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </TextBlock.Triggers>
                </TextBlock>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
